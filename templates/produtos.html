{% extends "base.html" %}
{% block title %}Produtos{% endblock %}
{% block content %}
<div class="row">
  <!-- FORMUL√ÅRIO COMPACTO (col-md-3) -->
  <div class="col-md-3 mb-3">
    <div class="card shadow-sm h-100">
      <div class="card-header bg-primary text-white">
        <h6 class="mb-0">‚ûï Novo produto</h6>
      </div>
      <div class="card-body p-2">
        <form method="post">
          <div class="mb-1">
            <input name="nome_produto" class="form-control form-control-sm" placeholder="Nome" required>
          </div>
          
          <div class="row g-1 mb-2">
            <div class="col-6">
              <input name="custo" type="number" step="0.01" class="form-control form-control-sm" placeholder="Custo">
            </div>
            <div class="col-6">
              <input name="venda" type="number" step="0.01" class="form-control form-control-sm" placeholder="Venda">
            </div>
          </div>

          <div class="row g-1 mb-2">
            <div class="col-6">
              <input name="quantidade" type="number" class="form-control form-control-sm" placeholder="Qtd" value="0">
            </div>
            <div class="col-6">
              <input name="estoque_minimo" type="number" class="form-control form-control-sm" placeholder="M√≠n" value="0">
            </div>
          </div>

          <select name="id_local" class="form-select form-select-sm mb-1" required>
            <option value="">Local</option>
            {% for local in locais %}
            <option value="{{ local.id }}">{{ local.nome_local }}</option>
            {% endfor %}
          </select>

          <select name="id_fornecedor" class="form-select form-select-sm mb-1" required>
            <option value="">Fornecedor</option>
            {% for fornecedor in fornecedores %}
            <option value="{{ fornecedor.id }}">{{ fornecedor.nome_fornecedor }}</option>
            {% endfor %}
          </select>

          <select name="id_categoria" class="form-select form-select-sm mb-2" required>
            <option value="">Categoria</option>
            {% for categoria in categorias %}
            <option value="{{ categoria.id }}">{{ categoria.nome_categoria }}</option>
            {% endfor %}
          </select>

          <button class="btn btn-primary w-100 btn-sm">Salvar</button>
        </form>
      </div>
    </div>
  </div>

  <!-- TABELA GRANDE (col-md-9) -->
  <div class="col-md-9">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title mb-3">Produtos ({{ produtos|length }})</h5>
        {% if produtos %}
        <div class="table-responsive" style="font-size: 0.85rem;">
          <table class="table table-sm table-hover">
            <thead class="table-dark">
              <tr>
                <th style="width: 50px;">ID</th>
                <th style="width: 150px;">Produto</th>
                <th style="width: 70px;">Custo</th>
                <th style="width: 70px;">Venda</th>
                <th style="width: 80px;">Estoque</th>
                <th style="width: 70px;">M√≠nimo</th>
                <th style="width: 120px;">Local</th>
                <th style="width: 130px;">Fornecedor</th>
                <th style="width: 120px;">Categoria</th>
                <th style="width: 180px;">A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              {% for p in produtos %}
              <tr>
                <td><strong>{{ p.id }}</strong></td>
                <td>{{ p.nome_produto }}</td>
                <td>R$ {{ "%.2f"|format(p.custo_produto_Unit) }}</td>
                <td>R$ {{ "%.2f"|format(p.valor_venda_Unit) }}</td>
                <td>
                  <span class="badge bg-{{ 'success' if p.quantidade >= p.estoque_minimo else 'danger' }} fs-6">
                    {{ p.quantidade }}
                  </span>
                </td>
                <td>{{ p.estoque_minimo }}</td>
                <td>{{ p.local_nome }}</td>
                <td>{{ p.fornecedor_nome }}</td>
                <td>{{ p.categoria_nome }}</td>
                <td>
                  <!-- BOT√ïES COMPACTOS NA MESMA LINHA -->
                  <div class="input-group input-group-sm" style="width: 140px;">
                    <input type="number" name="quantidade_entrada" class="form-control form-control-sm text-center" 
                           style="width: 45px; height: 32px;" min="1" placeholder="+" required form="form-entrada-{{ p.id }}">
                    <button type="submit" form="form-entrada-{{ p.id }}" class="btn btn-success" style="width: 35px; height: 32px;">
                      ‚ûï
                    </button>
                    <input type="number" name="quantidade_saida" class="form-control form-control-sm text-center" 
                           style="width: 45px; height: 32px;" min="1" max="{{ p.quantidade }}" placeholder="-" required form="form-saida-{{ p.id }}">
                    <button type="submit" form="form-saida-{{ p.id }}" class="btn btn-danger" style="width: 35px; height: 32px;">
                      ‚ûñ
                    </button>
                  </div>
                  
                  <!-- Forms hidden -->
                  <form id="form-entrada-{{ p.id }}" method="post" action="{{ url_for('produtos') }}" style="display: none;">
                    <input type="hidden" name="id_produto" value="{{ p.id }}">
                    <input type="hidden" name="acao" value="entrada">
                  </form>
                  <form id="form-saida-{{ p.id }}" method="post" action="{{ url_for('produtos') }}" style="display: none;">
                    <input type="hidden" name="id_produto" value="{{ p.id }}">
                    <input type="hidden" name="acao" value="saida">
                  </form>
                  
                  <!-- Deletar -->
                  <div class="mt-1">
                    <form method="post" action="{{ url_for('deletar_produto', id_produto=p.id) }}" class="d-inline">
                      <button class="btn btn-outline-danger btn-sm px-1" onclick="return confirm('Excluir?')" style="width: 35px; height: 32px;">
                        üóëÔ∏è
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center py-4 text-muted">
          Nenhum produto cadastrado
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
